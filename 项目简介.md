# 项目简介 - 鲲鹏创新大赛作品

## 项目概述

本项目是一个面向鲲鹏生态的边云协同智能语音交互系统，部署于OrangePi Kunpeng Pro开发板，实现了端侧音视频处理与云端智能分析的紧密协作。系统采用C++实现高性能边缘端处理模块，结合Python构建云端智能服务，通过NUMA感知内存分配和CPU亲和性调度优化，充分发挥鲲鹏架构的多核性能优势。项目探索了NPU硬件加速集成方案，通过将供料线程绑定到特定NUMA节点（Node 0，鲲鹏CPU 16GB内存域），配合numactl进行内存分配优化，确保数据访问的本地性，降低跨NUMA访问延迟。在NPU加速路径中，CPU端通过亲和性调度维持稳定的数据供给，持续打满NPU输入缓冲，最大化硬件利用率；在纯CPU处理模式下，NUMA内存分配策略同样保证了音频编解码流水线的高效运行，实现了低延迟、高并发的实时语音识别与交互响应能力，为鲲鹏平台的边缘智能场景提供了完整的技术实践方案。

## 核心技术要点

### 1. 边云协同架构
- **边缘端（C++）**：OrangePi Kunpeng Pro上的高性能音视频采集、预处理、编码与解码模块
- **云端（Python）**：智能语音识别(ASR)服务、自然语言处理与业务逻辑处理
- **通信机制**：基于高效网络协议的实时数据传输与同步

### 2. NUMA与CPU亲和性优化
- **内存分配优化**：利用numactl工具将关键数据结构分配到Node 0（鲲鹏CPU主内存域，16GB），减少跨节点内存访问延迟，提升缓存命中率
- **CPU绑核策略**：将音频处理线程、编解码线程绑定到cpu0-3（均位于Node 0），确保数据处理的局部性，降低NUMA远程访问开销
- **供料线程亲和性**：在NPU加速场景下，通过CPU亲和性调度将数据供料线程固定在特定核心，保证NPU输入缓冲的稳定、持续填充，最大化NPU吞吐量

### 3. NPU硬件加速集成（探索性方案）
- **加速目标**：音频特征提取、神经网络推理等计算密集型任务
- **集成策略**：通过CPU端稳定供料机制，配合亲和性调度，持续打满NPU输入缓冲区，充分发挥NPU算力
- **灵活性设计**：系统同时支持纯CPU处理路径，在NPU不可用或未调试完成时，仍可通过优化的CPU多线程处理保证服务稳定性与性能

### 4. 音视频处理优化
- **FFmpeg集成**：基于FFmpeg 4.2.1实现高效的音视频解复用、解码与编码
- **SDL多媒体输出**：利用SDL2实现跨平台音频播放和视频渲染
- **音视频同步**：基于音频时钟的精确同步策略，确保播放质量
- **多线程架构**：独立的解复用、解码、渲染线程，配合队列式缓冲机制，提升并发处理能力

## 技术亮点

1. **鲲鹏生态适配**：充分利用鲲鹏CPU的多核架构，通过NUMA感知和CPU亲和性优化，在OrangePi Kunpeng Pro开发板上实现高性能边缘计算

2. **内存访问优化**：numactl配置Node 0内存分配策略，结合CPU0-3绑核，显著降低NUMA远程访问延迟，提升音频处理流水线效率

3. **硬件加速探索**：设计了NPU加速集成方案，通过亲和性调度确保CPU供料线程稳定性，为NPU持续提供数据，探索边缘AI加速的最佳实践

4. **边云协同设计**：端侧与云端均运行在同一OrangePi Kunpeng Pro硬件上，通过进程隔离和资源调度，实现边缘智能与云服务的协同优化

5. **服务稳定性**：采用多路径处理机制，NPU与CPU处理路径可动态切换，确保在各种硬件条件下的服务可用性

## 应用场景

- **智能语音助手**：低延迟的实时语音识别与对话交互
- **边缘音视频处理**：本地化的音视频编解码与智能分析
- **物联网终端**：边缘设备的多媒体处理与云端协同
- **智能会议系统**：实时语音转写与智能会议记录

## 性能优化总结

通过NUMA内存分配策略（numactl）和CPU亲和性调度的组合优化，本项目在OrangePi Kunpeng Pro平台上实现了：
- 音频编解码延迟降低
- 内存访问效率提升
- CPU多核利用率优化
- NPU（如集成成功）输入缓冲饱和度提升

这些优化措施充分发挥了鲲鹏架构的硬件特性，为边缘智能应用提供了高性能、低延迟的处理能力。

---

**作者邮箱**: 1832578485@qq.com  
**开发平台**: OrangePi Kunpeng Pro  
**参赛项目**: 鲲鹏创新大赛 - 开发板赛道
